-- CRIAR A BASE DE DADOS
-- LICITACOES_EMPRESARIAIS_NOME;

CREATE DATABASE LICITACOES_EMPRESARIAIS_SARAH_NARAYAMY;

USE LICITACOES_EMPRESARIAIS_SARAH_NARAYAMY;
 
-- 1 CRIAR A TABELA DE EMPRESAS
-- CAMPOS: ID, NOME, CIDADE, CNPJ

CREATE TABLE COMPANIES (
 	ID INT AUTO_INCREMENT PRIMARY KEY,
    COMPANY_NAME VARCHAR(100) NOT NULL,
    CITY VARCHAR(50),
    CNPF VARCHAR(18)
 );
 
-- 2 CRIAR A TABELA DE CONTRATOS
-- CAMPOS: ID, ID_EMPRESA, OBJETO, VALOR, DATA_ASSINATURA

CREATE TABLE CONTRACTS (
 	ID INT AUTO_INCREMENT PRIMARY KEY,
    COMPANY_ID INT,
    OBJECT VARCHAR(50) NOT NULL,
    CONTRACT_VALUE  DECIMAL(15,2) NOT NULL,
    SIGN_DATE DATE,
    FOREIGN KEY (COMPANY_ID) REFERENCES COMPANIES(ID)
 );
 
-- 3 CRIAR A TABELA DE PAGAMENTOS
-- CAMPOS: ID, ID_CONTRATO, VALOR_PAGO, DATA_PAGAMENTO

CREATE TABLE PAYMENTS (
 	ID INT AUTO_INCREMENT PRIMARY KEY,
    CONTRACT_ID INT,
    PAID_VALUE DECIMAL(15,2),
    PAY_DATE DATE,
    FOREIGN KEY (CONTRACT_ID) REFERENCES CONTRACTS(ID)
 );
 
-- 4 POPULAR AS TABELAS COM 50 DADOS CADA

INSERT INTO COMPANIES (COMPANY_NAME, CITY, CNPF) VALUES
('Alpha Solutions Ltda', 'São Paulo', '12.345.678/0001-01'),
('Beta Tech S.A.', 'Rio de Janeiro', '23.456.789/0001-02'),
('Gamma Comércio ME', 'Belo Horizonte', '34.567.890/0001-03'),
('Delta Engenharia Ltda', 'Curitiba', '45.678.901/0001-04'),
('Epsilon Logística S.A.', 'Porto Alegre', '56.789.012/0001-05'),
('Zeta Digital Ltda', 'Florianópolis', '67.890.123/0001-06'),
('Sigma Construções', 'Salvador', '78.901.234/0001-07'),
('Orion Consultoria', 'Brasília', '89.012.345/0001-08'),
('Nexus Energia S.A.', 'Campinas', '90.123.456/0001-09'),
('Prime Agro Ltda', 'Ribeirão Preto', '11.234.567/0001-10'),
('Astra Tecnologia', 'Fortaleza', '12.345.678/0001-11'),
('Vector Systems', 'São Paulo', '13.456.789/0001-12'),
('Horizon Motors', 'Curitiba', '14.567.890/0001-13'),
('Skyline Telecom', 'Belo Horizonte', '15.678.901/0001-14'),
('Nova Vida Saúde', 'Recife', '16.789.012/0001-15'),
('Urban Food', 'Rio de Janeiro', '17.890.123/0001-16'),
('Green Earth Ltda', 'Manaus', '18.901.234/0001-17'),
('Blue Ocean S.A.', 'Natal', '19.012.345/0001-18'),
('Redline Design', 'São Paulo', '20.123.456/0001-19'),
('Sunrise Importadora', 'Santos', '21.234.567/0001-20'),
('Core Finance', 'Curitiba', '22.345.678/0001-21'),
('NextGen Data', 'São Paulo', '23.456.789/0001-22'),
('Track Solutions', 'Fortaleza', '24.567.890/0001-23'),
('Urban Transport', 'Salvador', '25.678.901/0001-24'),
('Infinity Labs', 'Campinas', '26.789.012/0001-25'),
('Pixel Studio', 'Porto Alegre', '27.890.123/0001-26'),
('SmartBuild Engenharia', 'Curitiba', '28.901.234/0001-27'),
('SoftLink Systems', 'São Paulo', '29.012.345/0001-28'),
('Helix Pharma', 'Rio de Janeiro', '30.123.456/0001-29'),
('EcoLuz Energia', 'Belo Horizonte', '31.234.567/0001-30'),
('Oceanic Export', 'Fortaleza', '32.345.678/0001-31'),
('Tetra Engenharia', 'Campinas', '33.456.789/0001-32'),
('Magna Auto', 'São Paulo', '34.567.890/0001-33'),
('Zenith Consulting', 'Curitiba', '35.678.901/0001-34'),
('SoftCare Saúde', 'Recife', '36.789.012/0001-35'),
('RapidPay Fintech', 'São Paulo', '37.890.123/0001-36'),
('MoveOn Transportes', 'Salvador', '38.901.234/0001-37'),
('DataPrime', 'Belo Horizonte', '39.012.345/0001-38'),
('GrowUp Marketing', 'São Paulo', '40.123.456/0001-39'),
('Bright Energy', 'Campinas', '41.234.567/0001-40'),
('Future Vision', 'Curitiba', '42.345.678/0001-41'),
('Connect Telecom', 'Rio de Janeiro', '43.456.789/0001-42'),
('MegaFoods', 'Fortaleza', '44.567.890/0001-43'),
('Nova Construções', 'Porto Alegre', '45.678.901/0001-44'),
('FlyHigh Airlines', 'São Paulo', '46.789.012/0001-45'),
('UrbanSmart', 'Curitiba', '47.890.123/0001-46'),
('TechWave', 'Campinas', '48.901.234/0001-47'),
('EcoTech Brasil', 'Manaus', '49.012.345/0001-48'),
('PrimeTech', 'São Paulo', '50.123.456/0001-49'),
('ZeroWaste', 'Salvador', '51.234.567/0001-50');

INSERT INTO CONTRACTS (COMPANY_ID, OBJECT, CONTRACT_VALUE, SIGN_DATE) VALUES
(1, 'Consultoria em TI', 150000.00, '2023-02-10'),
(2, 'Desenvolvimento de sistema', 320000.00, '2023-04-15'),
(3, 'Serviço de manutenção', 85000.00, '2022-11-05'),
(4, 'Projeto de engenharia', 600000.00, '2024-01-20'),
(5, 'Transporte logístico', 125000.00, '2023-06-01'),
(7, 'Obra civil', 980000.00, '2022-12-10'),
(8, 'Auditoria contábil', 90000.00, '2023-07-15'),
(9, 'Fornecimento de energia', 450000.00, '2024-02-12'),
(10, 'Consultoria agrícola', 110000.00, '2023-10-18'),
(11, 'Licenciamento de software', 200000.00, '2024-04-05'),
(12, 'Implantação de ERP', 700000.00, '2023-08-25'),
(13, 'Venda de veículos', 400000.00, '2022-09-30'),
(15, 'Plano de saúde corporativo', 180000.00, '2023-03-20'),
(16, 'Fornecimento de alimentos', 250000.00, '2023-05-02'),
(18, 'Serviços marítimos', 550000.00, '2024-06-12'),
(19, 'Design corporativo', 120000.00, '2023-09-01'),
(20, 'Serviços financeiros', 500000.00, '2023-11-21'),
(22, 'Consultoria em dados', 300000.00, '2023-10-11'),
(23, 'Transporte urbano', 270000.00, '2023-12-01'),
(25, 'Produção de mídia', 150000.00, '2023-08-15'),
(26, 'Construção de ponte', 950000.00, '2022-10-10'),
(27, 'Licença de software', 175000.00, '2024-01-01'),
(28, 'Distribuição farmacêutica', 650000.00, '2023-07-19'),
(30, 'Consultoria energética', 400000.00, '2023-02-22'),
(31, 'Exportação de produtos', 520000.00, '2024-04-30'),
(33, 'Auditoria técnica', 230000.00, '2023-09-15'),
(34, 'Consultoria empresarial', 330000.00, '2022-12-01'),
(35, 'Plano de saúde', 180000.00, '2023-06-25'),
(36, 'Serviços financeiros', 250000.00, '2023-11-05'),
(37, 'Transporte interestadual', 140000.00, '2024-03-03'),
(38, 'Consultoria em dados', 280000.00, '2023-01-18'),
(39, 'Marketing digital', 120000.00, '2024-05-10'),
(40, 'Instalação solar', 870000.00, '2023-02-11'),
(41, 'Planejamento urbano', 920000.00, '2023-09-09'),
(42, 'Telefonia corporativa', 310000.00, '2022-11-11'),
(43, 'Distribuição alimentícia', 200000.00, '2023-07-13'),
(44, 'Construção civil', 980000.00, '2023-05-25'),
(45, 'Serviços aéreos', 700000.00, '2023-08-20'),
(46, 'Automação predial', 340000.00, '2023-12-14'),
(47, 'Serviços de TI', 220000.00, '2024-02-09'),
(48, 'Gestão ambiental', 280000.00, '2023-10-17'),
(49, 'Suporte técnico', 150000.00, '2022-12-20'),
(50, 'Consultoria ESG', 400000.00, '2023-09-29'),
(2, 'Serviços em nuvem', 150000.00, '2023-03-18'),
(7, 'Projeto habitacional', 600000.00, '2024-03-30'),
(12, 'Atualização de sistema', 100000.00, '2024-05-02'),
(18, 'Fornecimento elétrico', 320000.00, '2023-06-09'),
(30, 'Estudo técnico', 90000.00, '2024-01-10'),
(45, 'Treinamento aéreo', 50000.00, '2023-09-12'),
(48, 'Coleta de resíduos', 130000.00, '2024-03-18');

INSERT INTO PAYMENTS (CONTRACT_ID, PAID_VALUE, PAY_DATE) VALUES
(1, 50000.00, '2023-03-10'),
(1, 100000.00, '2023-05-20'),
(2, 320000.00, '2023-08-01'),
(3, 50000.00, '2023-01-15'),
(4, 300000.00, '2024-03-05'),
(5, 125000.00, '2023-07-02'),
(7, 980000.00, '2023-02-10'),
(8, 90000.00, '2023-08-20'),
(9, 250000.00, '2024-04-10'),
(10, 110000.00, '2023-12-01'),
(11, 200000.00, '2024-06-10'),
(12, 350000.00, '2023-10-30'),
(13, 200000.00, '2022-12-15'),
(15, 90000.00, '2023-06-10'),
(16, 150000.00, '2023-08-01'),
(18, 200000.00, '2024-07-01'),
(19, 120000.00, '2023-10-15'),
(20, 500000.00, '2023-12-15'),
(22, 150000.00, '2023-11-10'),
(23, 270000.00, '2024-01-20'),
(25, 75000.00, '2023-09-01'),
(26, 950000.00, '2023-04-01'),
(27, 175000.00, '2024-02-02'),
(28, 325000.00, '2023-09-25'),
(31, 260000.00, '2024-05-20'),
(33, 230000.00, '2023-10-12'),
(34, 165000.00, '2023-01-15'),
(35, 90000.00, '2023-07-20'),
(36, 250000.00, '2023-12-20'),
(37, 70000.00, '2024-04-10'),
(38, 280000.00, '2023-03-05'),
(39, 120000.00, '2024-06-01'),
(40, 435000.00, '2023-04-10'),
(41, 460000.00, '2023-10-01'),
(42, 310000.00, '2022-12-11'),
(43, 100000.00, '2023-09-25'),
(44, 490000.00, '2023-07-12'),
(45, 350000.00, '2023-09-25'),
(46, 170000.00, '2024-02-20'),
(47, 220000.00, '2024-03-25'),
(48, 280000.00, '2023-11-20'),
(49, 75000.00, '2023-01-10'),
(50, 200000.00, '2024-02-01'),
(4, 150000.00, '2024-05-15'),
(9, 200000.00, '2024-06-01'),
(12, 200000.00, '2024-01-15'),
(18, 100000.00, '2024-08-01'),
(40, 435000.00, '2023-09-10'),
(44, 490000.00, '2023-08-20'),
(45, 350000.00, '2023-12-01');

-- 1 MOSTRAR TODOS OS CONTRATOS E SUAS EMPRESAS 
-- DICA: USE INNER JOIN
-- MOSTRAR O NOME DA EMPRESA, OBJETO DO CONTRATO E VALOR

SELECT 
    CP.COMPANY_NAME,
    C.OBJECT,
    CONCAT('R$ ', FORMAT(C.CONTRACT_VALUE, 2, 'pt_BR')) AS CONTRACT_VALUE
FROM CONTRACTS C
INNER JOIN COMPANIES CP
    ON C.COMPANY_ID = CP.ID
ORDER BY CP.COMPANY_NAME;
 
-- 2 MOSTRAR TODAS AS EMPRESAS E SEUS CONTRATOS 
-- DICA: USE LEFT JOIN
-- MOSTRAR TAMBÉM AS EMPRESAS QUE AINDA NÃO POSSUEM CONTRATOS

SELECT 
    CP.COMPANY_NAME,
    C.OBJECT,
    CONCAT('R$ ', FORMAT(C.CONTRACT_VALUE, 2, 'pt_BR')) AS CONTRACT_VALUE
FROM COMPANIES CP
LEFT JOIN CONTRACTS C
    ON CP.ID = C.COMPANY_ID
ORDER BY CP.COMPANY_NAME;
 
-- 3 MOSTRAR TODOS OS CONTRATOS E SEUS PAGAMENTOS 
-- DICA: USE RIGHT JOIN
-- MOSTRAR MESMO QUE ALGUM PAGAMENTO NÃO TENHA CONTRATO VÁLIDO

SELECT
    C.ID AS CONTRACT_ID,
    C.OBJECT AS CONTRACT_OBJECT,
    CONCAT('R$ ', FORMAT(C.CONTRACT_VALUE, 2, 'pt_BR')) AS CONTRACT_VALUE,
    CONCAT('R$ ', FORMAT(P.PAID_VALUE, 2, 'pt_BR')) AS PAID_VALUE,
    P.PAY_DATE
FROM CONTRACTS C
RIGHT JOIN PAYMENTS P
    ON C.ID = P.CONTRACT_ID
ORDER BY P.PAID_VALUE;
 
-- 4 MOSTRAR CONTRATOS CUJO VALOR ESTEJA ENTRE 200000 E 600000 
-- E MOSTRAR O NOME DA EMPRESA RESPONSÁVEL
-- DICA: USE INNER JOIN E BETWEEN

SELECT
    CP.COMPANY_NAME,
    C.OBJECT AS CONTRACT_OBJECT,
    CONCAT('R$ ', FORMAT(C.CONTRACT_VALUE, 2, 'pt_BR')) AS CONTRACT_VALUE
FROM CONTRACTS C
INNER JOIN COMPANIES CP
    ON C.COMPANY_ID = CP.ID
WHERE C.CONTRACT_VALUE BETWEEN 200000 AND 600000
ORDER BY C.CONTRACT_VALUE;
 
-- 5 MOSTRAR TODOS OS CONTRATOS COM PAGAMENTOS REALIZADOS ENTRE '2024-05-01' E '2024-06-30' 
-- DICA: USE JOIN E BETWEEN NA DATA

SELECT
    CP.COMPANY_NAME,
    CONCAT('R$ ', FORMAT(C.CONTRACT_VALUE, 2, 'pt_BR')) AS CONTRACT_VALUE,
    CONCAT('R$ ', FORMAT(P.PAID_VALUE, 2, 'pt_BR')) AS PAID_VALUE,
    P.PAY_DATE
FROM CONTRACTS C
INNER JOIN COMPANIES CP
    ON C.COMPANY_ID = CP.ID
INNER JOIN PAYMENTS P
    ON C.ID = P.CONTRACT_ID
WHERE P.PAY_DATE BETWEEN '2024-05-01' AND '2024-06-30'
ORDER BY CP.COMPANY_NAME;
 
-- 6 MOSTRAR OS CONTRATOS COM VALOR MAIOR QUE 300000 
-- MAS APENAS DAS EMPRESAS LOCALIZADAS EM 'São Paulo' OU 'Curitiba'
-- DICA: USE INNER JOIN E WHERE COM IN()

SELECT
    CP.COMPANY_NAME,
    CP.CITY,
    C.OBJECT AS CONTRACT_OBJECT,
    CONCAT('R$ ', FORMAT(C.CONTRACT_VALUE, 2, 'pt_BR')) AS CONTRACT_VALUE
FROM CONTRACTS C
INNER JOIN COMPANIES CP
    ON C.COMPANY_ID = CP.ID
WHERE C.CONTRACT_VALUE > 300000 AND CP.CITY IN ('São Paulo', 'Curitiba')
ORDER BY CP.CITY;
 
-- 7 MOSTRAR O TOTAL PAGO POR CONTRATO 
-- DICA: USE INNER JOIN, SUM() E AS PARA CRIAR UMA COLUNA CHAMADA TOTAL_PAGO

SELECT
    CP.COMPANY_NAME AS COMPANY_NAME,
    C.OBJECT AS CONTRACT_OBJECT,
    CONCAT('R$ ', FORMAT(C.CONTRACT_VALUE, 2, 'pt_BR')) AS CONTRACT_VALUE,
    CONCAT('R$ ', FORMAT(SUM(P.PAID_VALUE), 2, 'pt_BR')) AS TOTAL_PAGO,
    CONCAT('R$ ', FORMAT(C.CONTRACT_VALUE - SUM(P.PAID_VALUE), 2, 'pt_BR')) AS FALTANTE
FROM CONTRACTS C
INNER JOIN COMPANIES CP
    ON C.COMPANY_ID = CP.ID
INNER JOIN PAYMENTS P
    ON C.ID = P.CONTRACT_ID
GROUP BY CP.COMPANY_NAME, C.OBJECT, C.CONTRACT_VALUE
ORDER BY CP.COMPANY_NAME;

 
-- 8 MOSTRAR AS EMPRESAS QUE AINDA NÃO RECEBERAM NENHUM PAGAMENTO 
-- DICA: USE LEFT JOIN E WHERE IS NULL

SELECT
    CP.COMPANY_NAME,
    CP.CITY,
    C.OBJECT AS CONTRACT_OBJECT,
    CONCAT('R$ ', FORMAT(C.CONTRACT_VALUE, 2, 'pt_BR')) AS CONTRACT_VALUE
FROM COMPANIES CP
INNER JOIN CONTRACTS C
    ON CP.ID = C.COMPANY_ID
LEFT JOIN PAYMENTS P
    ON C.ID = P.CONTRACT_ID
WHERE P.ID IS NULL
ORDER BY CP.COMPANY_NAME;
 
-- 9 MOSTRAR OS CONTRATOS CUJO OBJETO CONTENHA A PALAVRA 'CONSTRUÇÃO' 
-- DICA: USE LIKE '%CONSTRUÇÃO%'

SELECT
    C.OBJECT AS CONTRACT_OBJECT,
    CP.COMPANY_NAME AS COMPANY_NAME,
    CONCAT('R$ ', FORMAT(C.CONTRACT_VALUE, 2, 'pt_BR')) AS CONTRACT_VALUE
FROM CONTRACTS C
INNER JOIN COMPANIES CP
    ON C.COMPANY_ID = CP.ID
WHERE C.OBJECT LIKE '%CONSTRUÇÃO%'
ORDER BY CP.COMPANY_NAME;
 
-- 10 DESAFIO: MOSTRAR UM RELATÓRIO COMPLETO COM:
-- NOME DA EMPRESA, CIDADE, OBJETO DO CONTRATO, VALOR, VALOR_PAGO, DATA_PAGAMENTO
-- DICA: USE INNER JOIN ENTRE AS 3 TABELAS (EMPRESAS, CONTRATOS, PAGAMENTOS)

SELECT
    CP.COMPANY_NAME AS COMPANY_NAME,
    CP.CITY AS CITY,
    C.OBJECT AS CONTRACT_OBJECT,
    CONCAT('R$ ', FORMAT(C.CONTRACT_VALUE, 2, 'pt_BR')) AS CONTRACT_VALUE,
    CONCAT('R$ ', FORMAT(P.PAID_VALUE, 2, 'pt_BR')) AS PAID_VALUE,
    P.PAY_DATE AS PAY_DATE
FROM COMPANIES CP
INNER JOIN CONTRACTS C
    ON CP.ID = C.COMPANY_ID
INNER JOIN PAYMENTS P
    ON C.ID = P.CONTRACT_ID
ORDER BY CP.COMPANY_NAME, P.PAY_DATE;


